# NPRG031 - L Systems

**Term Project**

- Author: Vojtěch Pröschl
- Supervisor: [Mgr. Pavel Ježek, Ph.D.](https://d3s.mff.cuni.cz/legacy/~jezek/)

---

Main resources: [The Algorithmic Beauty of Plants](http://algorithmicbotany.org/papers/#abop) and [Wikipedia](https://www.wikipedia.org)

## User Documentation

### About L-Systems

The concrete L-System type that is supported by the program is called `Bracketed OL-system`, as described in the [The Algorithmic Beauty of Plants](http://algorithmicbotany.org/papers/#abop) at the page 26. To be more precise `OL-System` is combination of `DOL-System` with a support for stack operations for the turtle state.

Rules in the system are essentially the same as in [Context Free Grammar](https://en.wikipedia.org/wiki/Context-free_grammar), besides the fact that `DOL-Systems` don't differentiate between terminal and non-terminal symbols. We can consider ASCII symbols to be alphabet of this grammar.

Rules have the following form
$$
\mathrm{AllowedRuleTypes}=\{A\to \alpha:A\in \Sigma \wedge \alpha \in \Sigma^*\}
$$
where
$$
\Sigma=\mathrm{ASCIISymbols} \setminus (\text{WhiteSymbols}\cup \{;\})
$$
Also in the entire system, there can be at most single rule for each symbol.

Derivation process works as follows:

- For each symbol in sentence:
  - Apply rule if it exists, otherwise apply identity

This entire process is done $n$ times, where $n$ is user selected constant, that I call `Step Count` in this project.

### About Turtle Interpretation of Strings

The most common way to use strings generated by L-Systems to generate geometry is turtle interpretation. The main idea is to use use "turtle", which is entity, that lives in the 3D space, that can move forward, draw lines and rotate in various directions. For more information about turtle interpretation please refeer to the book [The Algorithmic Beauty of Plants](http://algorithmicbotany.org/papers/#abop). Turtle model is described in detail on pages 6, 19 and 24. My model works exactly as described in the book.

Turtle in the model has two underlying variables:

- $\delta$ - distance that the turtle should travel when moving forward

- $\alpha$​ - the angle by which the turtle should rotate

And has support for the following symbols:

`F` - Move forward and draw a line

`f` - Move forward without drawing a line

`+` - Turn left

`-` - Turn right

`&` - Pitch down

`^` - Pitch up

`\ ` - Roll left

`/` - Roll right

`|` - Turn around

`[` - Push turtle state to stack

`]` - Pop turtle state from stack and set is as current state

### Instructions

The program has text-based user interface. Here is a complete list of instructions available:

- `help`
  - Lists available instructions
- `templates`
  - Lists available templates
- `template [template name]`
  - Configures the generator according to certain template
  - Available templates are listed in the following section
- `display current configuration`
  - Displays current configuration of the generator
- `derive sentence`
  - Uses current configuration to derive sentence
- `display derived sentence`
  - Displays most recently derived sentence
- `clear configuration`
  - Clears configuration of the generator
- `set axiom [axiom]`
  - Sets initial symbol of the grammar to `[axiom]`
- `add rule [{CHAR}->{STRING}]`
  - Adds rule to the generator
  - If rule for that character alredy exists, this command redefines it
- `load configuration [{filename}.txt]`
  - Loads configuration of the generator from text file
  - The exact format is described in the input section
- `set step count [step count]`
  - Sets number of steps in the derivation process
- `save turtle interpretation [{filename}.obj]`
  - Interprets the most recently derived sequence using turtle interpretation and generates .obj file using the data
- `save derived sentence [{filename}.txt]`
  - Saves most recently derived sentence to textfile

### How to use the program

The program is controlled by instructions specified above

**Standard procedure:**

1. Define grammar
2. Derive sentence
3. Export derived sentence either in its .txt form or .obj form

### Templates

#### `KochSnowflake`

<img src="Results/KochSnowflake.png" alt="Koch Snowflake" style="height: 400px; width:400px;"/>

#### `KochIsland`

<img src="Results/KochIsland.png" alt="Koch Island" style="height: 350px; width:400px;"/>

#### `HilbertCurve2D`

<img src="Results/HilbertCurve2D.png" alt="Hilbert Curve 2D" style="height: 400px; width:400px;"/>

#### `HilbertCurve3D`

<img src="Results/HilbertCurve3D.png" alt="Hilbert Curve 3D" style="height: 400px; width:400px;"/>

#### `Tree2D`

<img src="Results/Tree2D.png" alt="Tree 2D" style="height: 500px; width:400px;"/>

#### `Tree3D`

<img src="Results/Tree3D.png" alt="Tree 3D" style="height: 400px; width:400px;"/>

### Input

File in the following format can be imported as a grammar

**Format**

```
Line 0: [Distance];[Angle];[Initial Sentence];[Number of Steps]
Line 1: [Char C1]->[Sentence S1]
Line 2: [Char C2]->[Sentence S2]
...
Line n+1: [Char Cn]->[Sentence Sn]
```

**Components**

- `[Distance]`: Floating point number in the format `X,Y`, where X is an integer number and Y is a sequence of numbers 0,...,9 and is greater than 0
- `[Angle]`: Same as distance
- `[Initial Sequence]`: Sequence of ASCII characters excluding ';' and white characters
- `[Number of Steps]`: Natural number {0,1,2,...}
- `[Char Ci]`: Single ASCII character
- `[Sentence Si]`: Sequence of ASCII characters

### Output

- You can output `.obj` file representing turtle representation of the derived sentence using `save turtle interpretation [{filename}.obj]` command
- You can output `.txt` file representing the derived sentence using `save derived sentence [{filename}.txt]`

## Programming Documentation

The project is divided into folder structure, where each folder serves different purpose

### Generation

#### `class LSystem`

Is responsible for the entire derivation process of the grammar. The system works by iteratively replacing all symbols in the sentence according to the specified rules.

### Interpretation

#### `struct Turtle`

This structs represents entity, that lives in 3D space and has defined transformation according to the ABOP book. 

#### `class TurtleInterpreter`

This class interprets sentences according to the turtle graphics rules. It works according to the specification stated at the page 24 in  [The Algorithmic Beauty of Plants](http://algorithmicbotany.org/papers/#abop). It generates list of polygonal lines which trace out path of the turtle.

### IO

#### `class ModelConfigurationImporter`

Purpose of this class is to parse configurations of the LSystems which are in the format specified above.

#### `class SentenceExporter`

This class exports sentence generated by the grammar as a text file

#### `class TurtleInterpretationExporter`

This class exports turtle interpretation of the sentence derived by the grammar as an `.obj` file. [OBJ format specification](https://www.loc.gov/preservation/digital/formats/fdd/fdd000507.shtml)

### LSystem Factory

#### `class LSystemFactory`

This class generates various grammars which serve both as examples and starting points for further exploration of the LSystems.

### Mathematics

#### `struct Matrix`

Structure representing $\mathbb{R}^{3\times 3}$ matrix. It incorporates a few fundamental operations.

#### `class PolygonalLine`

Sequence of vectors that represents polygonal line in $\mathbb{R}^3$

#### `struct Vector`

Structure representing $\mathbb{R}^3$ vector. It incorporates a few fundamental operations.

### MVC

#### `class Controller`

Class that processes user console inputs and manipulates model.

#### `class Model`

Class that represents model of the program.

#### `struct ModelConfiguratio`

Struct that represents configuration of the model.

#### `class View`

Class that presents TUI to the user.